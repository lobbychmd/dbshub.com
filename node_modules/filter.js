var db = require('config').db();

exports.login_filter = function (req, res, next) {
    //var auth = new fitnode.snsauth(config.db(), config.auth_config);

    if (!req.session["user"] ) {
        res.redirect("/account/login?rel=" + req.url.toString());
    }
    else {
        req.global_data = { user: req.session.user};
        next();
    }
  };

  exports.auth_filter = function (req, res, next) {
      db.collection("Project").find({}).toArray(function (err, prjs) {
          if (!req.global_data) req.global_data = {};
          req.global_data.projects = prjs;
          if (!req.session.project) req.session.project = prjs[0]._id.toString();
          next();
      });

  };